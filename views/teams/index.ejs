<%- include("../partials/html-head")  %> 
<%- include("../partials/nav")  %> 

<main>
  <h1>Teams </h1>
  <% teams.forEach(team => { %>
    <h2> <%= team.name %> </h2>
    <table>
      <thead>
        <tr>
          <th> Player </th>
          <th> Role </th>
          <th> Details</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td> <%= team.captain.name %> </td>
          <td> Captain </td>
          <td> 
            <a href= <%=`/profile/${team.captain._id}`%>>Info</a>  
          </td>
        </tr>
        <% let userInTeam = false%>
        <% team.players.forEach(player => { %>
          <% if (player._id.equals(user.playerProfile._id)){ %>
            <% userInTeam = true %>
          <%} %>
          <tr>
            <td> <%= player.name %> </td>
            <td> Player </td>
            <td> 
              <a href= <%=`/profile/${player._id}`%>>Info</a>  
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>
    <% if (user.playerProfile._id.equals(team.captain._id)){ %>
      <p>You are captain of this team!</p>
    <% } else if (userInTeam) { %>
      <p> You are a player in this team!</p>
    <% } else if (user) { %>
      <form action="/teams/<%=team._id%>?_method=PATCH" method="POST">
        <button type="submit"> Join Team</button>
      </form>
    <% } %>
    <h4> Team Schedule </h4>
  <% }) %>
</main>

<%- include("../partials/footer")  %> 